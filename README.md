#SCRTN: Enhancing Multi-Modal 3D Object Detection in Complex Environments
This is a official code release of SCRTN (SCRTN: Enhancing Multi-Modal 3D Object Detection in Complex Environments). 
This code is mainly based on [OpenPCDet](https://github.com/open-mmlab/OpenPCDet), 
some codes are from [SFD](https://github.com/LittlePey/SFD), 
some codes are from [VirConv](https://github.com/hailanyi/VirConv),
some codes are from [CompletionFormer](https://github.com/youmi-zym/CompletionFormer).



1.  Prepare  environment. 
Our released implementation is tested on.
+ Ubuntu 20.04
+ Python 3.9.13 
+ PyTorch 1.8.1
+ Numba 0.53.1
+ Spconv 2.1.22 # pip install spconv-cu111
+ NVIDIA CUDA 11.1 
+ 2x 3090 GPUs



2. Prepare dataset

The dense depth maps we provide are generated by CompletionFormer or TWISE or PENet. 

Anyway, the data structure should be:

SCRTN

    ├── data
    │   ├── kitti_scrtn_seguv_twise
    │   │   │── ImageSets
    │   │   │── training
    │   │   │   ├──calib & velodyne & label_2 & image_2 & (optional: planes) & depth_dense_twise & depth_pseudo_rgbseguv_twise
    │   │   │── testing
    │   │   │   ├──calib & velodyne & image_2 & depth_dense_twise & depth_pseudo_rgbseguv_twise
    │   │   │── gt_database
    │   │   │── gt_database_pseudo_seguv
    │   │   │── kitti_dbinfos_train_scrtn_seguv.pkl
    │   │   │── kitti_infos_test.pkl
    │   │   │── kitti_infos_train.pkl
    │   │   │── kitti_infos_trainval.pkl
    │   │   │── kitti_infos_val.pkl
    ├── pcdet
    ├── tools



3. Setup.

    ```
    cd SCRTN
    python setup.py develop

    ```

### Training.

Single GPU train:
```
cd tools
python3 train.py --cfg_file ${CONFIG_FILE}
```
For example, if you train the model:
```
cd tools
python3 train.py --cfg_file cfgs/kitti_models/sctrn.yaml 
```

Multiple GPU train: 

You can modify the gpu number in the dist_train.sh and run
```
cd tools
sh dist_train.sh
```
The log infos are saved into log.txt
You can run ```cat log.txt``` to view the training process.


### Evaluation.

```
cd tools
python3 test.py --cfg_file ${CONFIG_FILE} --batch_size ${BATCH_SIZE} --ckpt ${CKPT}
```

For example, if you test the model:

```
cd tools
python3 test.py --cfg_file cfgs/models/kitti/sctrn.yaml  --ckpt sctrn.pth
```

Multiple GPU test: you need modify the gpu number in the dist_test.sh and run
```
sh dist_test.sh 
```
The log infos are saved into log-test.txt
You can run ```cat log-test.txt``` to view the test results.
